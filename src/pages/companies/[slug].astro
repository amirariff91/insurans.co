---
import Base from '../../layouts/Base.astro';
import companies from '../../data/companies.json';

export function getStaticPaths() {
  return companies.map((company) => ({
    params: { slug: company.slug },
    props: { company },
  }));
}

const { company } = Astro.props;

const productNamesBM: Record<string, string> = {
  'car': 'Insurans Kereta',
  'motorcycle': 'Insurans Motosikal',
  'health': 'Insurans Kesihatan / Medical Card',
  'life': 'Insurans Nyawa',
  'travel': 'Insurans Travel',
  'home': 'Insurans Rumah / Kebakaran',
  'personal-accident': 'Insurans Kemalangan Diri',
};

const otherCompanies = companies.filter(c => c.slug !== company.slug).slice(0, 5);

const schema = {
  "@context": "https://schema.org",
  "@type": "Organization",
  "name": company.fullName,
  "url": company.website,
  "description": company.descriptionBM || company.description,
  "aggregateRating": {
    "@type": "AggregateRating",
    "ratingValue": company.rating,
    "bestRating": 5,
    "worstRating": 1,
    "ratingCount": 100,
  }
};
---

<Base
  title={`${company.name} — Review Insurans Malaysia 2026`}
  description={`Review ${company.name} Malaysia. ${company.verdictBM} Rating: ${company.rating}/5. Produk, kelebihan, kekurangan, dan perbandingan.`}
  schema={schema}
>
  <!-- Header -->
  <section class="bg-white border-b border-stone-200">
    <div class="container-wide py-10 sm:py-14">
      <nav class="text-sm text-stone-400 mb-5">
        <a href="/" class="hover:text-hijau-700 text-stone-500">Utama</a>
        <span class="mx-2">›</span>
        <a href="/companies/" class="hover:text-hijau-700 text-stone-500">Syarikat</a>
        <span class="mx-2">›</span>
        <span class="text-stone-700">{company.name}</span>
      </nav>

      <div class="max-w-3xl">
        <p class="label mb-3">Review Syarikat</p>
        <h1 class="font-serif text-headline-lg text-stone-900 mb-2">
          {company.name}
        </h1>
        <p class="text-sm text-stone-400 mb-4">
          {company.fullName}
          {company.parent && <span> · {company.parent}</span>}
        </p>
        <p class="text-lg text-stone-600 leading-relaxed">
          {company.verdictBM}
        </p>

        <!-- Quick facts inline -->
        <div class="flex flex-wrap items-center gap-x-5 gap-y-2 mt-5 text-sm text-stone-600">
          <span class="font-semibold text-emas-600">★ {company.rating}/5</span>
          <span>Est. {company.founded}</span>
          <span>{company.headquarters}</span>
          {company.takaful && (
            <span class="font-medium text-hijau-700">Takaful tersedia</span>
          )}
        </div>
      </div>
    </div>
  </section>

  <div class="container-wide py-10 sm:py-14">
    <div class="grid lg:grid-cols-3 gap-10 lg:gap-14">
      <!-- Main Content -->
      <div class="lg:col-span-2">
        <article class="prose-editorial">

          <h2>Tentang {company.name}</h2>
          <p>{company.descriptionBM || company.description}</p>

          {company.takaful && company.takafulEntity && (
            <p>
              {company.name} juga menawarkan produk takaful (patuh Syariah) melalui
              <strong>{company.takafulEntity}</strong>.
            </p>
          )}

          {company.keyFact && (
            <div class="info-box my-6">
              <p class="text-sm text-stone-700">
                <strong>Fakta menarik:</strong> {company.keyFact}
              </p>
            </div>
          )}

        </article>

        <!-- Pros & Cons -->
        <div class="grid sm:grid-cols-2 gap-4 my-8">
          <div class="bg-hijau-50 border border-hijau-200 p-5">
            <h3 class="font-semibold text-hijau-800 text-sm mb-3">Kelebihan</h3>
            <ul class="space-y-2">
              {company.pros.map((pro: string) => (
                <li class="text-sm text-hijau-700 flex items-start gap-2">
                  <span class="text-hijau-500 mt-0.5 flex-shrink-0">+</span>
                  <span>{pro}</span>
                </li>
              ))}
            </ul>
          </div>
          <div class="bg-stone-50 border border-stone-200 p-5">
            <h3 class="font-semibold text-stone-700 text-sm mb-3">Kekurangan</h3>
            <ul class="space-y-2">
              {company.cons.map((con: string) => (
                <li class="text-sm text-stone-600 flex items-start gap-2">
                  <span class="text-stone-400 mt-0.5 flex-shrink-0">−</span>
                  <span>{con}</span>
                </li>
              ))}
            </ul>
          </div>
        </div>

        <!-- Products -->
        <article class="prose-editorial">
          <h2>Produk yang ditawarkan</h2>
        </article>

        <div class="grid grid-cols-2 gap-3 my-6">
          {company.products.map((product: string) => (
            <div class="flex items-center gap-3 p-3 border border-stone-200 bg-white">
              <span class="text-hijau-600 font-bold text-sm">✓</span>
              <span class="text-sm text-stone-800">{productNamesBM[product] || product}</span>
            </div>
          ))}
        </div>

        {company.carPremiumRange && (
          <div class="my-8">
            <article class="prose-editorial">
              <h2>Harga insurans kereta</h2>
              <p>
                Anggaran harga insurans kereta (comprehensive) di {company.name} untuk kereta popular:
              </p>
            </article>
            <div class="bg-krim-50 border border-krim-200 p-5 my-4">
              <p class="text-sm text-stone-700">
                <strong>Anggaran premium (Myvi/Axia):</strong> {company.carPremiumRange}
              </p>
              <p class="text-xs text-stone-500 mt-2">
                Harga bergantung pada NCD, umur kereta, dan add-ons. Dapatkan quotation tepat di
                <a href="https://bjak.my" target="_blank" rel="noopener" class="text-hijau-700 underline">Bjak.my</a>
                atau terus di
                <a href={company.website} target="_blank" rel="noopener" class="text-hijau-700 underline">{company.name} Online</a>.
              </p>
            </div>
          </div>
        )}

        <!-- Contact & Links -->
        <article class="prose-editorial">
          <h2>Maklumat hubungan</h2>
        </article>

        <div class="my-6 space-y-3">
          <div class="flex items-start gap-3 text-sm">
            <span class="text-stone-400 w-20 flex-shrink-0 font-medium">Website</span>
            <a href={company.website} target="_blank" rel="noopener" class="text-hijau-700 underline hover:text-hijau-600 break-all">
              {company.website.replace('https://', '')}
            </a>
          </div>
          {company.claimLine && (
            <div class="flex items-start gap-3 text-sm">
              <span class="text-stone-400 w-20 flex-shrink-0 font-medium">Claim</span>
              <span class="text-stone-900 font-semibold">{company.claimLine}</span>
            </div>
          )}
          {company.digitalPlatform && (
            <div class="flex items-start gap-3 text-sm">
              <span class="text-stone-400 w-20 flex-shrink-0 font-medium">Platform</span>
              <span class="text-stone-700">{company.digitalPlatform}</span>
            </div>
          )}
        </div>

        <!-- CTA -->
        <div class="border-2 border-stone-900 p-5 my-8">
          <h3 class="font-serif text-lg text-stone-900 mb-2">Lawati {company.name}</h3>
          <p class="text-sm text-stone-600 mb-4">
            Dapatkan quotation atau maklumat lanjut terus dari {company.name}.
          </p>
          <a
            href={company.website}
            target="_blank"
            rel="noopener noreferrer"
            class="btn-hijau text-sm"
          >
            Pergi ke {company.name} →
          </a>
        </div>
      </div>

      <!-- Sidebar -->
      <aside class="lg:col-span-1">
        <div class="lg:sticky lg:top-20 space-y-6">
          <!-- Quick Facts -->
          <div class="bg-white border-2 border-stone-900 p-5">
            <h3 class="font-serif text-lg text-stone-900 mb-4">Ringkasan</h3>
            <dl class="space-y-3 text-sm">
              <div class="flex justify-between">
                <dt class="text-stone-500">Rating</dt>
                <dd class="font-semibold text-emas-600">★ {company.rating}/5</dd>
              </div>
              <div class="flex justify-between">
                <dt class="text-stone-500">Jenis</dt>
                <dd class="font-medium capitalize">{company.type === 'takaful' ? 'Takaful' : 'Konvensional'}</dd>
              </div>
              <div class="flex justify-between">
                <dt class="text-stone-500">Takaful</dt>
                <dd class="font-medium">{company.takaful ? 'Ada' : 'Tiada'}</dd>
              </div>
              <div class="flex justify-between">
                <dt class="text-stone-500">Ditubuhkan</dt>
                <dd class="font-medium">{company.founded}</dd>
              </div>
              <div class="flex justify-between">
                <dt class="text-stone-500">Ibu pejabat</dt>
                <dd class="font-medium">{company.headquarters}</dd>
              </div>
              {company.parent && (
                <div class="flex justify-between">
                  <dt class="text-stone-500">Induk</dt>
                  <dd class="font-medium text-right">{company.parent}</dd>
                </div>
              )}
              <div class="flex justify-between">
                <dt class="text-stone-500">Produk</dt>
                <dd class="font-medium">{company.products.length} jenis</dd>
              </div>
            </dl>
          </div>

          <!-- Other Companies -->
          <div class="card-editorial">
            <h3 class="font-semibold text-sm text-stone-900 mb-3">Syarikat lain</h3>
            <ul class="space-y-2.5">
              {otherCompanies.map((c) => (
                <li class="flex items-baseline justify-between">
                  <a href={`/companies/${c.slug}/`} class="text-sm text-hijau-700 hover:text-hijau-600 font-medium">
                    {c.name}
                  </a>
                  <span class="text-xs text-stone-500">★ {c.rating}</span>
                </li>
              ))}
            </ul>
            <a href="/companies/" class="block mt-4 text-xs text-stone-500 hover:text-hijau-700 font-medium">
              Lihat semua syarikat →
            </a>
          </div>

          <!-- Related pages -->
          <div class="card-editorial">
            <h3 class="font-semibold text-sm text-stone-900 mb-3">Baca juga</h3>
            <ul class="space-y-2.5 text-sm">
              {company.products.includes('car') && (
                <li><a href="/car-insurance/" class="text-hijau-700 hover:text-hijau-600">Panduan insurans kereta</a></li>
              )}
              <li><a href="/guides/ncd-explained/" class="text-hijau-700 hover:text-hijau-600">NCD — panduan lengkap</a></li>
              {company.takaful && (
                <li><a href="/takaful/" class="text-hijau-700 hover:text-hijau-600">Insurans vs Takaful</a></li>
              )}
            </ul>
          </div>
        </div>
      </aside>
    </div>
  </div>
</Base>
